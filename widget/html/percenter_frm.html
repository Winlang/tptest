<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <title>APP</title>
    <link rel="stylesheet" type="text/css" href="../css/aui.css" />
    <style>
          .per-avatar{
               border:none;
               border-radius: 50%;
               display:block;
               width:60px;
               height:60px;
          }
/*          .aui-text-danger{
               position: relative;
          }*/
          .per-badge{
               display:inline-block;
               width:60px;
               height:30px;
               line-height:30px;
               text-align:center;
               border:1px solid #858F87;
               border-radius:15px;
               color:#858F87;
               font-size:14px;
               position: absolute;
               top:50%;
               right:15px;
               margin-top:-15px;
          }
          .rank{
              font-size: 14px;
              color:#858F87;
              padding:0 5px;
              line-height:28px;
          }
          .per-account div{
             display:inline-block;
          }
          .coin{
               font-size:20px;
          }
          .per-change{
              float:right;
              
          }
          .per-change span{
              border-left:1px solid #858F87;
              padding-right:10px;
              padding-left:10px;
          }
          .per-change i.aui-iconfont{
              margin:0;
          }
          .per-setting{
            font-size:12px;
            margin-right:5px;  
            line-height:25px;
          }
    </style>
</head>
<body>
    <div class="aui-content">
        <ul class="aui-list-view aui-in">
            <li class="aui-list-view-cell aui-img">
            <img id="avatar_img" tapmode onclick="update_avatar()" class="aui-img-object aui-pull-left per-avatar" src="../image/demo2.png" alt="" />
            <div class="aui-img-body">
                  <span class="aui-text-danger"><em id="nickname" tapmode onclick="login()">登陆/注册</em><!--<em class="per-badge" tapmode onclick="openInfo()">资料</em>--></span>
                  <div class="aui-ellipsis-1"><i class="aui-badge aui-badge-theme">LV.1</i><span class="rank">议员</span></div>                                
            </div>
            </li>

            
            <li class="aui-list-view-cell per-account">
                 <div>金币：<span class="aui-text-danger coin" id="coin">0</span></div>
                 <!--<div class="per-change">
                       <span><i class="aui-iconfont aui-icon-pay aui-text-danger"></i>兑换</span> 
                       <span><i class="aui-iconfont aui-icon-form aui-text-danger"></i>明细</span>
                 </div>-->               
            </li>
          
            <!--<li class="aui-list-view-cell" tapmode onclick="openFocus()">
               <div class="aui-arrow-right">
                     <i class="aui-iconfont aui-icon-edit aui-bg-info"></i>关注
                     <span class="per-setting  aui-text-default aui-pull-right aui-ellipsis-1">兴趣；主题；选项；票友</span>
               </div>
            </li>-->
            <li class="aui-list-view-cell" tapmode onclick="openThemes()">
               <div class="aui-arrow-right">
                      <i class="aui-iconfont aui-icon-activity aui-bg-info"></i>我发起的主题
                      <span id='myitem_num' class="per-setting  aui-text-default aui-pull-right aui-ellipsis-1"></span>
               </div>               
            </li>
            <!--<li class="aui-list-view-cell">
               <div class="aui-arrow-right">
                     <i class="aui-iconfont aui-icon-favor aui-bg-danger"></i>我的票友
                     <span class="per-setting  aui-text-default aui-pull-right aui-ellipsis-1">共120好友</span>
               </div>              
            </li>
            <li class="aui-list-view-cell">
               <div class="aui-arrow-right">
                      <i class="aui-iconfont aui-icon-hotfill aui-bg-danger"></i>我的号召力
                      <span class="per-setting  aui-text-default aui-pull-right aui-ellipsis-1">37785</span>
               </div>             
            </li>-->
            <li class="aui-list-view-cell">
               <div class="aui-arrow-right">
                      <i class="aui-iconfont aui-icon-sponsor aui-bg-warning"></i>我的金币
                      <span class="per-setting  aui-text-default aui-pull-right aui-ellipsis-1" id="coin_1">0个</span>
               </div>             
            </li>
            <li class="aui-list-view-cell" tapmode onclick="openRank()">
               <div class="aui-arrow-right">  
                      <i class="aui-iconfont aui-icon-choiceness aui-bg-primary"></i>积分等级        
                      <span id="level" class="per-setting  aui-text-default aui-pull-right aui-ellipsis-1"></span>
               </div>
            </li>
             <li class="aui-list-view-cell" tapmode onclick="openMyZan()">
               <div class="aui-arrow-right">
                      <i class="aui-iconfont aui-icon-appreciate aui-bg-warning"></i>我的赞
                      <span class="per-setting  aui-text-default aui-pull-right aui-ellipsis-1"></span>
               </div>             
            </li>
            <li class="aui-list-view-cell" tapmode onclick="openCollect()">
               <div class="aui-arrow-right">
                      <i class="aui-iconfont aui-icon-favor aui-bg-danger"></i>我的收藏
                      <span class="per-setting  aui-text-default aui-pull-right aui-ellipsis-1"></span>
               </div>             
            </li>
        </ul>
    </div>
    <!--<div class="aui-content">
         <ul class="aui-list-view aui-in">
            <li class="aui-list-view-cell">
                <div class="aui-arrow-right">
                     <i class="aui-iconfont aui-icon-redpacket aui-bg-danger"></i>拆红包
                     <span class="per-setting  aui-text-default aui-pull-right aui-ellipsis-1">123个未拆红包</span>
                </div>
            </li>
            <li class="aui-list-view-cell">
                <div class="aui-arrow-right">
                      <i class="aui-iconfont aui-icon-friendadd aui-bg-theme"></i>邀请好友
                      <span class="per-setting  aui-text-default aui-pull-right aui-ellipsis-1">提升号召力，获得金币暴涨</span>
                </div>
            </li>
        </ul>
    </div>-->
    <section class="aui-content">
        <!--退出后显示-->
        <ul class="aui-list-view logout_show">
            <li class="aui-list-view-cell" tapmode onclick="login()">
                <a class="aui-arrow-right">
                   <i class="aui-iconfont aui-icon-friendadd aui-bg-info"></i>  登录
                </a>
            </li>
            <li class="aui-list-view-cell" tapmode onclick="register()">
                <a class="aui-arrow-right">
                   <i class="aui-iconfont aui-icon-friendfamous aui-bg-success"></i> 注册
                </a>
            </li>
            
        </ul>

        <!--登陆后显示-->
        <ul class="aui-list-view logined_show">
        <li class="aui-list-view-cell" tapmode onclick="dologout()">
                <a class="aui-arrow-right">
                   <i class="aui-iconfont aui-icon-backdelete aui-bg-danger"></i> 退出
                </a>
        </li>
        </ul>
    </section>
</body>
<script type="text/javascript" src="../script/api.js" ></script>
<script type="text/javascript" src="../script/jquery.js" ></script>
<script type="text/javascript" src="../script/config.js" ></script>
<script type="text/javascript" src="../script/common.js" ></script>
<script type="text/javascript" src="../script/user.js" ></script>

<script type="text/javascript" src="../script/template.js" ></script>
<script type="text/javascript">
    function openFocus(){
       api.openWin({
          name:'focus_win',
          url:'focus_win.html',
          bounces:true,
          rect:{
             x:0,
             y:0,
             w:'auto',
             h:'auto'
          }
       });
    }
    function openThemes(){
       api.openWin({
          name:'my_themes_win',
          url:'my_themes_win.html',
          bounces:true,
          rect:{
             x:0,
             y:0,
             w:'auto',
             h:'auto'
          }
       });
    }
    function openInfo(){
       api.openWin({
         name: 'my_info_win',
         url: 'my_info_win.html',
         bounces:true,
          rect:{
             x:0,
             y:0,
             w:'auto',
             h:'auto'
          }
       });
    }
   //打开我的收藏列表
   function openCollect(){
       api.openWin({
         name: 'collect_win',
         url: 'collect_win.html',
         bounces:true,
          rect:{
             x:0,
             y:0,
             w:'auto',
             h:'auto'
          }
       });
    }
   //打开我的积分等级
   function openRank(){
       api.openWin({
         name: 'rank_intg_win',
         url: 'rank_intg_win.html',
         bounces:true,
          rect:{
             x:0,
             y:0,
             w:'auto',
             h:'auto'
          }
       });
    }
    //打开我的赞列表
    function openMyZan(){
       api.openWin({
         name: 'my_zan_win',
         url: 'my_zan_win.html',
         bounces:true,
          rect:{
             x:0,
             y:0,
             w:'auto',
             h:'auto'
          }
       });
    }
   function register(){
        api.openWin({
            name: 'register_win',
            url: 'register_win.html',
            delay:delay
        });
    }
    function login(){
        var uid = is_login();
        if(uid > 0){

        }else{
          login_page();
        }
    }

    function update_avatar(){
        var uid = is_login();
        if(uid > 0){
          getPicture();
        }else{
          login_page();
        }
    }

    // function logout(){
    //   api.removePrefs({
    //       key : "userinfo"
    //       }, function(ret, err) {
    //             alert("用户已退出登录");
    //             api.openWin({
    //                     name : 'reg_login_win',
    //                     url : 'reg_login_win.html',
    //                     pageParam : {
    //                             name : 'test'
    //                     }
    //             });
    //       });
    // }


    var delay = 0;
    apiready = function () {
          // 监听退出操作
          api.addEventListener({
                  name : 'logoutEvent'
          }, function(ret) {
                if (ret && ret.value) {

                    var value = ret.value;

                    $('#nickname').html('登陆/注册');
                    $('.logined_show').hide();
                    $('.logout_show').show();
                }
          });


          // 监听是否注册或者登录成功   监听成功
          api.addEventListener({
                  name : 'reg_login_successEvent'
          }, function(ret) {
                if (ret && ret.value) {
                    var value = ret.value;
                    $('#nickname').html(value.name);
                    if(value.type == 'wx_login'){
                        $('#avatar_img').attr('src',value.wx_avatar);
                    }else{
                        $('#avatar_img').attr('src',UploadUrl+'/avatar/'+value.avatar);
                    }
                    
                    $('.logined_show').show();
                    $('.logout_show').hide();
                }
          });

          // 监听头像上传成功
          api.addEventListener({
                  name : 'avatar_upload_successEvent'
          }, function(ret) {
                if (ret && ret.value) {
                    var value = ret.value;
                    var imgpath = UploadUrl+'/avatar/'+value.name;
                    $api.attr($api.byId("avatar_img"),'src',imgpath);
                }
          });
          


          //加载相关数据
          var uid = is_login();
          //获取用户登陆来源
          var login_type = $api.getStorage('login_type');

          //alert(uid);
          
          if(uid > 0){

              $('.logined_show').show();
              $('.logout_show').hide();
              //用户中心信息
              api.ajax({
                  url: ApiUrl+'/api/userinfo',
                  method: 'post',
                  data: {
                    values:{
                      'uid':uid,
                    }
                  }
              },function(data, err){
                  if(login_type == 'wx'){
                      //头像
                      var imgpath = data.wx_avatar;

                  }else if(login_type == 'qq'){

                      var imgpath = data.qq_avatar;

                  }else if(login_type == 'wb'){

                      var imgpath = data.wb_avatar;

                  }else{
                      //头像
                      var imgpath = UploadUrl+'/avatar/'+data.avatar;
                  }
                  
                  
                  $api.attr($api.byId("avatar_img"),'src',imgpath);
                  //昵称
                  $('#nickname').html(data.mobile);
                  //金币数量
                  $('#coin').html(data.coin);
                  $('#coin_1').html(data.coin+'个');
                  //积分等级
                  $('#level').html(data.level.lev_text);
                  //我发布主题数量
                  $('#myitem_num').html(data.myitem_num);
                  //票友数量
                  
                  //我的号召力
                  //积分等级
                  //红包数量
              });
              

          }else{
              $('.logined_show').hide();
              $('.logout_show').show();
          }
       
        
          api.parseTapmode();
        
          if(api.systemType != 'ios'){
              delay = 300;
          }
    }
</script>
</html>