<!DOCTYPE html>
 <html>
 <head>
 	<meta charset="UTF-8">
	<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
	<meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
	<title>增加主题</title>
	<link rel="stylesheet" type="text/css" href="../css/aui.css">
	<style type="text/css">
		body{
			background: #f4f4f4;
			width: 100%;
			height: 100%;
			padding-top: 15px;
		}
		.ask-show-box{
			display: block;
			background-color: #f2f2f2;
		}
		p.title {
			background: #f4f4f4;
			padding: 10px 0;
		}
		textarea.ask-text{
			width: 100%;
			border: none;
			height: 180px;
			font-size: 14px;
			margin-bottom: 0;
		}
		.option-img{
		  width:100%;
		  height:200px;
		  border:1px dashed #7935fe;
		  vertical-align:middle;
		  font-size:18px;
		}
		.add-pic{
		  display:block;
		  width:100%;
		  height:200px;
		  margin-top:-200px;
		  z-index: 10;
		}
		.middle{
		  display: inline-block;
		  height:100%;
		  vertical-align: middle;
		}
		.aui-content-padded {
			padding-bottom: 0;
		}
		.aui-input-row .aui-input{
		   line-height:1;
		   padding:5px;
		}
		
		.cate-caption{
		   color:#333;
		   padding:10px 5px 0px; 
		}
		.cate-list {
            background: none;
            text-align: center;
            overflow: hidden;
            padding:10px 5px;
        }
        .cate {
            text-align: center;
            font-size: 12px;
            margin: 0 5px 5px 5px;
            background: #fff;
            height: 32px;
            line-height: 32px;
            border: 1px solid #ddd;
            border-radius: 4px;
            color: #333;
            overflow: hidden;
        }

        .cate.active {
            background: #ff9900;
            border: 1px solid #ff9900;
            color: #ffffff;
            -webkit-animation: fadeIn .5s ease both;
                    animation: fadeIn .5s ease both;
        }
        .cate.disabled{
            background: #eeeeee;
            border-color: #eeeeee;
            color: #666;
        }
	</style>
 </head>
 <body>
 	<section class="aui-card">
	 		<div class="option-img aui-text-center aui-text-info" tapmode onclick="item_getPicture()">
	 		      <img src=""  id="item_bg_img" style="width:100%;height:200px;">
	 		      <div class="add-pic aui-text-theme">
	 		             <i class="aui-iconfont aui-icon-add"></i>
	 		             <span>添加主题图片</span>
	 		             <span class="middle"></span>   
	 		      </div>   
	 		</div>
	 		<input type="hidden" id="item_img_path" value="">
	 	<div class="aui-line-x"></div>
	 	<p class="aui-text-center title"></p>
	 	<div class="aui-line-x"></div>
	    <div class="aui-input-row">
	 	     <label class="aui-input-addon">主题名称</label>
	 	     <input class="aui-input" id="item_title" value="" placeholder="请输入您的主题名称" />
	 	</div>
 	    <p class="cate-caption">主题分类</p>
	    <div class="aui-content cate-list" id="catesinfo">
	    	<div class="">
	            <div class="aui-col-xs-3">
	                <div class="cate active" cate-data="1" data-status="1" tapmode title="122">娱乐</div>
	            </div>
	            <div class="aui-col-xs-3">
	                <div class="cate" cate-data="2" data-status="1" tapmode title="124">体育</div>
	            </div>    
	            <div class="aui-col-xs-3">
	                <div class="cate" cate-data="3" data-status="1" tapmode title="128">互联网</div>
	            </div>    
	            <div class="aui-col-xs-3">
	                <div class="cate" cate-data="4" data-status="1" tapmode title="133">追剧</div>
	            </div>
	            <div class="aui-col-xs-3">
	                <div class="cate" cate-data="5" data-status="1" tapmode title="134">国际</div>
	            </div>
	            <div class="aui-col-xs-3">
	                <div class="cate" cate-data="6" data-status="1" tapmode title="135">游戏</div>
	            </div>    
	            <div class="aui-col-xs-3">
	                <div class="cate" cate-data="7" data-status="1" tapmode title="136">美女</div>
	            </div>    
	            <div class="aui-col-xs-3">
	                <div class="cate" cate-data="8" data-status="1" tapmode title="137">搞笑</div>
	            </div> 
	            <div class="aui-col-xs-3">
	                <div class="cate" cate-data="9" data-status="1" tapmode title="138">社会</div>
	            </div>     
	        </div>
	    </div>
	    <!-- <script type="text/html" id='cates'>
	        <div class="">
		        {{each list as v i}}
		        	{{if i == 0}}
			            <div class="aui-col-xs-3">
			                <div class="cate active" cate-data="1" data-status="1" tapmode>{{v.title}}</div>
			            </div>
		            {{else}}
		            	<div class="aui-col-xs-3">
			                <div class="cate" cate-data="1" data-status="1" tapmode>{{v.title}}</div>
			            </div>
		            {{/if}}
		        {{/each}}  
	        </div>
	    </script> -->
	 	<div class="aui-line-x"></div>
	 	<p class="aui-text-center title">主题描述</p>
	 	<div class="aui-line-x"></div>
	 	<div class="aui-form">
	 		<textarea placeholder="请在此输入详情，描述的越详细，参加的人越多！" id="item_desc" class="ask-text"></textarea>
	 	</div>
 	</section>
 	<section class="aui-content-padded">
 		
 		<div class="aui-btn aui-btn-block aui-btn-theme" tapmode onclick="submit_item('next')">下一步</div>

 		<div style="margin-top:5px" class="aui-btn aui-btn-block aui-btn-success" tapmode onclick="submit_item('complate')">完成</div>
 	</section>
 </body>
<script type="text/javascript" src="../script/api.js"></script>
<script type="text/javascript" src="../script/config.js"></script>
<script type="text/javascript" src="../script/jquery.js"></script>
<script type="text/javascript" src="../script/common.js"></script>
<!-- <script type="text/javascript" src="../script/add_theme.js"></script> -->
<script type="text/javascript" src="../script/template.js"></script>

 <script type="text/javascript">
 	apiready = function(){
 		//调取主题分类
 		// cates();

 	    api.parseTapmode();
 	    // 监听主题图片上传成功
	    api.addEventListener({
	        name : 'item_upload_successEvent'
	    }, function(ret) {
            if (ret && ret.value) {
                var value = ret.value;
                var imgpath = UploadUrl+'/admin/vote_item/usercreate/'+value.name;
                $api.attr($api.byId("item_bg_img"),'src',imgpath);
                $('#item_img_path').val('vote_item/usercreate/'+value.name);
                $('.add-pic').css('display','none');
            }
	    });
	    
	    //主题分类
	    var cateList = $api.domAll(".cate");
        for(var i in cateList){
            $api.addEvt(cateList[i], 'click', function(){
                $api.removeCls($api.dom(".cate.active"),'active');
                $api.addCls(this,'active');
            });
        }
 	}

 	function submit_item(tag){
 		var item_titleimg = $('#item_img_path').val();
 		var item_title = $('#item_title').val();
 		var item_desc = $('#item_desc').val();
 		//获取主题分类的id
 		var item_cate = $('.aui-col-xs-3').children('div [class="cate active"]').attr('title');

 		//当前登录用户id
 		var item_member_id = is_login();
 		
 		if(item_titleimg == '' || item_titleimg == null){
 			alert('请您上传主题封面图');
 			return false;
 		}

 		if(item_title == '' || item_title == null){
 			alert('请您填写主题标题');
 			return false;
 		}

 		if(item_desc == '' || item_desc == null){
 			alert('请您填写主题描述');
 			return false;
 		}
 		//提交增加主题
 		api.ajax({
			    url: ApiUrl+'/api/additem/?callback=?',
			    method: 'post',
			    data: {
			    	values:{
			    		'item_title':item_title,
			    		'item_desc':item_desc,
			    		'item_titleimg':item_titleimg,
			    		'item_cate':item_cate,
			    		'item_member_id':item_member_id
			    	}
			    }
			},function(data, err){
			    if(data.status == 1){

              		var item_id = data.msg;
              		if(tag == 'complate'){
              			//跳至所增加的主题页
		            	openItem(item_id);
              		}else{
              			//跳至继续添加选项页
              			openOption(item_id);
              		}
		            
		            
              	}else{
              	  	alert(data.msg);
              	}
		});
 	}

function openVote(itemoptid){
       api.openWin({
	       name: 'votecon_frm',
	       url: 'votecon_frm.html?itemoptid='+itemoptid
       });
    }

function openOption(item_id){
       api.openWin({
	       name: 'add_option',
	       url: 'add_option_win.html?item_id='+item_id
       });
    }

function openItem(item_id){
	    api.openWin({
	        name: 'procon',
	        url: 'procon_add_win.html?item_id='+item_id,
	        bounces: true,
	        rect: {
	            x: 0,
	            y: 0,
	            w: 'auto',
	            h: 'auto'
	        }
	    });
	}
	
 </script>
 </html>